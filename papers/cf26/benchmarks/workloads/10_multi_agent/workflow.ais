// Multi-Agent Workflow
// Demonstrates A-PXM's direct flow calls for cross-agent invocation.
// Compiler detects dataflow dependencies and parallelizes where possible.

agent Researcher {
    flow research(topic: str) -> str {
        rsn "Conduct deep research on: " + topic -> findings
        return findings
    }
}

agent Critic {
    flow critique(content: str) -> str {
        rsn "Critically analyze and identify weaknesses: " + content -> feedback
        return feedback
    }

    flow prepare(topic: str) -> str {
        rsn "Prepare initial critique questions for: " + topic -> questions
        return questions
    }
}

agent Coordinator {
    @entry flow main(topic: str) -> str {
        // 1. These run in parallel (no dependencies between them)
        Researcher.research(topic) -> research_result
        Critic.prepare(topic) -> critique_prep

        // 2. This depends on research_result, runs after
        Critic.critique(research_result) -> critique_result

        // 3. Synthesize final report (consumes all outputs)
        rsn "Synthesize into final report. Research: " + research_result + " | Prepared questions: " + critique_prep + " | Critique: " + critique_result -> final_report
        return final_report
    }
}
